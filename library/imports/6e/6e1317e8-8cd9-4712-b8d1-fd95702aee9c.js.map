{"version":3,"sources":["../../../assets/assets/RainMaterial.js"],"names":["renderEngine","cc","renderer","math","vmath","gfx","Material","RainShader","require","RainMaterial","call","pass","Pass","setDepth","setCullMode","CULL_NONE","setBlend","BLEND_FUNC_ADD","BLEND_SRC_ALPHA","BLEND_ONE_MINUS_SRC_ALPHA","mainTech","Technique","name","type","PARAM_TEXTURE_2D","PARAM_FLOAT2","PARAM_FLOAT3","PARAM_FLOAT","_texture","_resolution","vec3","create","_texSize","vec2","_time","_effect","effect","Effect","_mainTech","js","extend","mixin","prototype","getTexture","setTexture","val","update","flipY","mipmap","setProperty","getImpl","_texIds","getId","x","width","y","height","setResolution","w","h","setTime","time","module","exports"],"mappings":"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","file":"RainMaterial.js","sourceRoot":"../../../assets","sourcesContent":["const renderEngine = cc.renderer.renderEngine;\nconst math = cc.vmath;\nconst renderer = renderEngine.renderer;\nconst gfx = renderEngine.gfx;\nconst Material = renderEngine.Material;\n\n// Require to load the shader to program lib\nconst RainShader = require('RainShader');\n\nfunction RainMaterial () {\n    Material.call(this, false);\n\n    var pass = new renderer.Pass('rainheart');\n    pass.setDepth(false, false);\n    pass.setCullMode(gfx.CULL_NONE);\n    pass.setBlend(\n      gfx.BLEND_FUNC_ADD,\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\n      gfx.BLEND_FUNC_ADD,\n      gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\n    );\n\n    let mainTech = new renderer.Technique(\n      ['transparent'],\n      [\n        { name: 'iTexture', type: renderer.PARAM_TEXTURE_2D },\n        { name: 'texSize', type: renderer.PARAM_FLOAT2 },\n        { name: 'iResolution', type: renderer.PARAM_FLOAT3 },\n        { name: 'iTime', type: renderer.PARAM_FLOAT },\n      ],\n      [\n        pass\n      ]\n    );\n\n    this._texture = null;\n    this._resolution = math.vec3.create();\n    this._texSize = math.vec2.create();\n    this._time = 0.0;\n\n    // need _effect to calculate hash\n    this._effect = this.effect = new renderer.Effect(\n      [\n        mainTech,\n      ],\n      {\n          'iResolution': this._resolution,\n          'texSize': this._texSize\n      },\n      []\n    );\n    \n    this._mainTech = mainTech;\n}\ncc.js.extend(RainMaterial, Material);\n\ncc.js.mixin(RainMaterial.prototype, {\n    getTexture () {\n        return this._texture;\n    },\n\n    setTexture (val) {\n        if (this._texture !== val) {\n            this._texture = val;\n            this._texture.update({\n                // Adapt to shader\n                flipY: true,\n                // For load texture\n                mipmap: true\n            });\n            this.effect.setProperty('iTexture', val.getImpl());\n            this._texIds['iTexture'] = val.getId();\n\n            this._texSize.x = this._texture.width;\n            this._texSize.y = this._texture.height;\n        }\n    },\n    \n    setResolution (w, h) {\n        this._resolution.x = w;\n        this._resolution.y = h;\n    },\n\n    setTime (time) {\n        this._time = time;\n        this.effect.setProperty('iTime', this._time);\n    }\n});\n\nmodule.exports = RainMaterial;"]}